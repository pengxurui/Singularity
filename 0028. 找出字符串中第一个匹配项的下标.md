## [28. æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡](https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/description/)

## é¢˜ç›®æè¿°

ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² haystack å’Œ needle ï¼Œè¯·ä½ åœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœ needle ä¸æ˜¯ haystack çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™è¿”å›  -1 ã€‚

## é¢˜ç›®è€ƒç‚¹

å¸¸è§çš„å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•åŒ…æ‹¬

- æš´åŠ›åŒ¹é…
- Knuth-Morris-Pratt ç®—æ³•
- Boyer-Moore ç®—æ³•
- Sunday ç®—


- æš´åŠ›åŒ¹é…ä¼šä¸¢å¼ƒ â€œéå®Œå…¨åŒ¹é…â€ è¿‡ç¨‹ä¸­çš„æ‰€æœ‰ä¿¡æ¯ï¼Œé€ æˆé‡å¤åŒ¹é…ï¼šä¸€æ—¦åŒ¹é…å¤±è´¥ï¼Œéœ€è¦å°†åŒ¹é…ä¸²çš„æŒ‡é’ˆè°ƒæ•´è‡³èµ·å§‹ä½ç½®ï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦æ˜¯ O(nm)

![image](https://user-images.githubusercontent.com/25008934/222658321-77b13fba-7759-4d82-9f78-882354896c18.png)

- KMP æ˜¯ä¸€ç§å¿«é€ŸæŸ¥æ‰¾åŒ¹é…ä¸²çš„ç®—æ³•ï¼Œå…¶å¿«é€Ÿçš„å…³é”®åœ¨äºåœ¨ â€œéå®Œå…¨åŒ¹é…â€ è¿‡ç¨‹ä¸­æå–å¹¶å¤ç”¨æœ‰æ•ˆä¿¡æ¯ï¼Œä»¥å‡å°‘é‡å¤åŒ¹é…ï¼šä¸€æ—¦åŒ¹é…å¤±è´¥ï¼Œä¼šæ ¹æ®å·²åŒ¹é…éƒ¨åˆ†ç›¸åŒå‰åç¼€é•¿åº¦ï¼Œç›´æ¥å°†åŒ¹é…ä¸²çš„æŒ‡é’ˆè·³è½¬åˆ°æœ€ä½³ä½ç½®ï¼Œï¼Œæ•´ä½“æ—¶é—´å¤æ‚åº¦æ˜¯ O(n + m)

![image](https://user-images.githubusercontent.com/25008934/222658337-d4fa46c4-fe95-498c-8d70-af9eb3f3426a.png)

ä¸¾ä¸ª ğŸŒ°ï¼Œå¯¹äºåŒ¹é…ä¸² abcabd ä¸­åŒ¹é…å¤±è´¥çš„å­—ç¬¦ d è€Œè¨€ï¼Œç”±å®ƒå‘èµ·çš„ä¸‹ä¸€ä¸ªåŒ¹é…ç‚¹è·³è½¬å¿…ç„¶æ˜¯å­—ç¬¦ c çš„ä½ç½®ã€‚å› ä¸ºåˆ°è¾¾ d ä¸€å®šè¯´æ˜ abcab æ˜¯åœ¨åŸä¸²ç§å­˜åœ¨çš„ï¼Œè€Œ abcab ç”¨ç›¸åŒçš„å‰åç¼€ abï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†åŒ¹é…ä¸²æŒ‡é’ˆä¿®æ”¹åˆ° cã€‚

sadbutsadï¼Œsad next => [0,0,0]

KMP å¿«åœ¨å“ªï¼Ÿ

- å³åˆ©ç”¨å·²åŒ¹é…éƒ¨åˆ†ä¸­ç›¸åŒçš„ã€Œå‰ç¼€ã€å’Œã€Œåç¼€ã€æ¥åŠ é€Ÿä¸‹ä¸€æ¬¡çš„åŒ¹é…ã€‚
- åŸä¸²æŒ‡é’ˆä¸ä¼šè¿›è¡Œå›æº¯ï¼ˆæ²¡æœ‰æœ´ç´ åŒ¹é…ä¸­å›åˆ°ä¸‹ä¸€ä¸ªã€Œå‘èµ·ç‚¹ã€çš„è¿‡ç¨‹ï¼‰ï¼Œéšç€åŒ¹é…è¿‡ç¨‹çš„è¿›è¡Œï¼ŒåŸä¸²æŒ‡é’ˆçš„ä¸æ–­å³ç§»ï¼Œæˆ‘ä»¬æœ¬è´¨ä¸Šæ˜¯åœ¨ä¸æ–­åœ°åœ¨å¦å†³ä¸€äº›ã€Œä¸å¯èƒ½ã€çš„æ–¹æ¡ˆã€‚

è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•é«˜æ•ˆåœ°è®¡ç®— â€œå·²åŒ¹é…éƒ¨åˆ†çš„ç›¸åŒå‰ç¼€å’Œåç¼€â€ ï¼Ÿ

- 1ã€ä½¿ç”¨ next å‰ç¼€è¡¨å®ç°å¿«é€Ÿå›é€€
- 2ã€next æ•°ç»„å­˜æ”¾çš„åŒ¹é…ä¸²å½“å‰ä½ç½® [i] ä¸ºæ­¢çš„ â€œæœ€é•¿ç›¸åŒå‰åç¼€â€ çš„é•¿åº¦ï¼Œä¹Ÿç›¸å½“äºä¸‹ä¸€ä¸ªæœŸå¾…åŒ¹é…ä½ç½®
- 3ã€åŒ¹é…å¤±è´¥æ—¶ï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªåŒ¹é…ä½ç½®çš„ next æ•°ç»„å€¼ O(1) è·å¾— â€œå·²åŒ¹é…éƒ¨åˆ†çš„ç›¸åŒå‰ç¼€å’Œåç¼€â€

`next æ•°ç»„`

![](https://user-images.githubusercontent.com/25008934/222661478-28a75d30-2fba-4d2e-a9b7-63a05f32c95b.png)

å¦‚ä½• O(m) æ—¶é—´æ„å»º next æ•°ç»„ï¼Ÿ

- åŸºäº needle æ•°ç»„
- å­—ç¬¦ä¸²çš„å‰ç¼€æ˜¯æŒ‡ä¸åŒ…å«æœ€åä¸€ä¸ªå­—ç¬¦çš„æ‰€æœ‰ä»¥ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å¤´çš„è¿ç»­å­ä¸²ï¼›
- å­—ç¬¦ä¸²çš„åç¼€æ˜¯æŒ‡ä¸åŒ…å«ç¬¬ä¸€ä¸ªå­—ç¬¦çš„æ‰€æœ‰ä»¥æœ€åä¸€ä¸ªå­—ç¬¦ç»“å°¾çš„è¿ç»­å­ä¸²ã€‚
- ç¬¬ [0] ä½ä¸º 0ï¼Œè¡¨ç¤ºä¸å­˜åœ¨ç›¸åŒçš„å‰åç¼€ï¼Œå› ä¸ºå®ƒçš„å‰ç¼€å’Œåç¼€éƒ½æ˜¯ç©ºï¼›
- j æŒ‡é’ˆä» 0 å¼€å§‹ï¼Œi æŒ‡é’ˆä» 1 å¼€å§‹ï¼Œåœ¨å¤–å±‚ i æŒ‡é’ˆçš„æ¯ä¸€å±‚å¾ªç¯ä¸­ï¼š
  - å¦‚æœ p[j] == p[i]ï¼Œé‚£ä¹ˆ next[i] = j + 1ï¼Œå¹¶ä¸” j æŒ‡é’ˆå³ç§»ï¼Œè¡¨ç¤ºåŒ¹é…çš„å‰åç¼€é•¿åº¦ + 1
  - å¦‚æœ p[j] != p[i]ï¼Œé‚£ä¹ˆ j = next[j - 1]ï¼Œè¡¨ç¤ºå›é€€åˆ°æœ€é•¿åŒ¹é…å‰ç¼€ä½ç½®ç»§ç»­å°è¯•åŒ¹é…

ä»¥ abcabf ä¸ºä¾‹ï¼š
- a æ—¶ï¼Œæœ€é•¿ç›¸åŒå‰åç¼€é•¿åº¦æ˜¯ 0
- ab æ—¶ï¼Œæœ€é•¿ç›¸åŒå‰åç¼€é•¿åº¦æ˜¯ 0
- abc æ—¶ï¼Œæœ€é•¿ç›¸åŒå‰åç¼€é•¿åº¦æ˜¯ 0
- abca æ—¶ï¼Œ æœ€é•¿ç›¸åŒå‰åç¼€é•¿åº¦æ˜¯ 1ï¼Œæ˜¯ a
- abcab æ—¶ï¼Œ æœ€é•¿ç›¸åŒå‰åç¼€é•¿åº¦ 2ï¼Œæ˜¯ ab
- abcabf æ—¶ï¼Œæ²¡æœ‰æœ€é•¿ç›¸åŒå‰åç¼€äº†ï¼Œé•¿åº¦æ˜¯ 0 ã€c ä¸ f ä¸åŒ¹é…ï¼Œj æŒ‡é’ˆå›é€€åˆ° 0ï¼Œa ä¸ f åˆä¸é…ï¼Œè·³å‡ºå†…å±‚å¾ªç¯ï¼ŒåŒ¹é…é•¿åº¦ä¸º 0ï¼‰

ä»¥ abfabf ä¸ºä¾‹ï¼š
- a æ—¶ï¼Œæœ€é•¿ç›¸åŒå‰åç¼€é•¿åº¦æ˜¯ 0
- ab æ—¶ï¼Œæœ€é•¿ç›¸åŒå‰åç¼€é•¿åº¦æ˜¯ 0
- abf æ—¶ï¼Œæœ€é•¿ç›¸åŒå‰åç¼€é•¿åº¦æ˜¯ 0
- abfa æ—¶ï¼Œ æœ€é•¿ç›¸åŒå‰åç¼€é•¿åº¦ 1ï¼Œæ˜¯ a
- abfab æ—¶ï¼Œ æœ€é•¿ç›¸åŒå‰åç¼€é•¿åº¦ 2ï¼Œæ˜¯ ab
- abfabf æ—¶ï¼Œæœ€é•¿ç›¸åŒå‰åç¼€é•¿åº¦ 3ï¼Œæ˜¯ abf

ä»¥ ababaabf ä¸ºä¾‹ï¼š
- a æ—¶ï¼Œæœ€é•¿å‰åç¼€é•¿åº¦æ˜¯ 0
- ab æ—¶ï¼Œæœ€é•¿å‰åç¼€é•¿åº¦æ˜¯ 0
- aba æ—¶ï¼Œæœ€é•¿å‰åç¼€é•¿åº¦æ˜¯ 1, æ˜¯ a
- abab æ—¶ï¼Œæœ€é•¿å‰åç¼€é•¿åº¦æ˜¯ 2ï¼Œæ˜¯ ab
- ababa æ—¶ï¼Œæœ€é•¿å‰åç¼€é•¿åº¦æ˜¯ 3ï¼Œæ˜¯ aba
- ababaa æ—¶ï¼Œã€ç®­å¤´æ‰€æŒ‡çš„ b ä¸ a ä¸åŒ¹é…ï¼Œj æŒ‡é’ˆå›é€€åˆ° [aba] çš„å‰ç¼€é•¿åº¦çš„ä¸‹ä¸€ä¸ªä½ç½® bï¼›b ä¸ a åˆä¸åŒ¹é…ï¼Œj æŒ‡é’ˆå›é€€åˆ° [a] çš„å‰ç¼€é•¿åº¦çš„ä¸‹ä¸€ä¸ªä½ç½® aï¼ŒåŒ¹é…ï¼Œæ‰€ä»¥æœ€é•¿ç›¸åŒå‰åç¼€é•¿åº¦æ˜¯ 1
- ababaab æ—¶ï¼Œæœ€é•¿å‰åç¼€é•¿åº¦æ˜¯ 2ï¼Œæ˜¯ ab
- ababaabf æ—¶ï¼Œã€j å›é€€åˆ° 0ã€‘æœ€é•¿ç›¸åŒå‰åç¼€é•¿åº¦æ˜¯ 0

`ä¸åŒ¹é…`
![](https://user-images.githubusercontent.com/25008934/222667911-4a94c0f0-1df9-4a00-96b8-208d00893716.png)

`å›é€€ j æŒ‡é’ˆ`
![](https://user-images.githubusercontent.com/25008934/222667998-f34d2733-7086-4fd7-ac8a-f5e0be45fe35.png)


å‚è€ƒï¼šhttps://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/solutions/575568/shua-chuan-lc-shuang-bai-po-su-jie-fa-km-tb86/

å‚è€ƒï¼šhttps://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/solutions/1119642/duo-tu-yu-jing-xiang-jie-kmp-suan-fa-by-w3c9c/

## é¢˜è§£ä¸€ï¼ˆæš´åŠ›åŒ¹é…ï¼‰

è®©å­—ç¬¦ä¸² needle ä¸å­—ç¬¦ä¸² haystack çš„æ‰€æœ‰é•¿åº¦ä¸º m çš„å­ä¸²å‡åŒ¹é…ä¸€æ¬¡

```
class Solution {
    fun strStr(haystack: String, needle: String): Int {
        val n = haystack.length
        val m = needle.length
        if (m == 0) return 0
        if (m > n) return -1
        outer@ for (i in 0..n - m) {
            for (offset in 0 until m) {
                if (haystack[i + offset] != needle[offset]) continue@ouuter
            }
            return i
        }
        return -1
    }
}
```

**å¤æ‚åº¦åˆ†æï¼š**

- æ—¶é—´å¤æ‚åº¦ï¼šO(nm)
- ç©ºé—´å¤æ‚åº¦ï¼šO(1) 

## é¢˜è§£äºŒï¼ˆKMPï¼‰

```
class Solution {
    fun strStr(haystack: String, needle: String): Int {
        val n = haystack.length
        val m = needle.length
        if (m == 0) return 0
        if (m > n) return -1
        // 1ã€å‰åç¼€åŒ¹é…é•¿åº¦
        val next = IntArray(n) { 0 }
        var j = 0
        for (i in 1 until m) {
            // æœªåŒ¹é…å›é€€ j æŒ‡é’ˆ
            while (j > 0 && needle[i] != needle[j]) {
                j = next[j - 1]
            }
            if (needle[i] == needle[j]) j++
            next[i] = j
        }
        // 2ã€å­—ç¬¦ä¸²åŒ¹é…
        j = 0
        for (i in 0 until n) {
            // æœªåŒ¹é…å›é€€ j æŒ‡é’ˆ
            while (j > 0 && haystack[i] != needle[j]) {
                j = next[j - 1]
            }
            // åŒ¹é…ä½ç½® + 1
            if (haystack[i] == needle[j]) j++
            // å®Œå…¨åŒ¹é…
            if (j == m) return i - m + 1
        }
        return -1
    }
}
```

**å¤æ‚åº¦åˆ†æï¼š**

- æ—¶é—´å¤æ‚åº¦ï¼šO(n + m)
- ç©ºé—´å¤æ‚åº¦ï¼šO(1) 
